- name: setup prompt
  ansible.builtin.shell: set-prompt {{ tool_name }}

- name: create github runner user
  ansible.builtin.user:
    name: github

- name: create github actions folder
  ansible.builtin.file:
    path: /actions-runner
    group: github
    state: directory
    owner: github

- name: download github runner
  ansible.builtin.unarchive:
    src: https://github.com/actions/runner/releases/download/v2.325.0/actions-runner-linux-x64-2.325.0.tar.gz
    dest: /actions-runner
    group: github
    owner: github
    remote_src: yes

- name: Get secret from vault
  ansible.builtin.debug:
    msg: "{{ lookup('community.hashi_vault.hashi_vault', 'secret=infra/data/github-runner:RUNNER_TOKEN token={{vault_token}} url=http://vault.mikeydevops1.online:8200/') }}"


#- name: configure github runner
#  ansible.builtin.shell: ./config.sh --url https://github.com/vinaybkrishna307/tool-setup --token "{{ lookup('community.hashi_vault.hashi_vault', 'roboshop-{{ env }}/data/{{ component_name }} token={{vault_token}} url=http://vault.mikeydevops1.online:8200/') }}"
#  args:
#    chdir: /actions-runner
#  become_user: github


#- name: setup runners
#  ansible.builtin.shell: |
#    mkdir actions-runner && cd actions-runner
#    curl -o actions-runner-linux-x64-2.325.0.tar.gz -L https://github.com/actions/runner/releases/download/v2.325.0/actions-runner-linux-x64-2.325.0.tar.gz
#    echo "5020da7139d85c776059f351e0de8fdec753affc9c558e892472d43ebeb518f4  actions-runner-linux-x64-2.325.0.tar.gz" | shasum -a 256 -c
#    tar xzf ./actions-runner-linux-x64-2.325.0.tar.gz

